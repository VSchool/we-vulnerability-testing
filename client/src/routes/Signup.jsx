import { useState } from "react"
import { Link, useNavigate } from "react-router-dom"
import { useAuthContext } from "../hooks";

export const Signup = () => {
    const { signup } = useAuthContext();
    const [credentials, setCredentials] = useState({ username: '', password: '' });
    const [error, setError] = useState(null);
    const [authorizing, setAuthorizing] = useState(false);
    const navigate = useNavigate()

    const handleChange = e => {
        const { name, value } = e.target;
        setCredentials(prev => ({ ...prev, [name]: value }));
    }

    const handleSubmit = async (e) => {
        setError(null);
        setAuthorizing(true);
        e.preventDefault();
        try {
            await signup(credentials)
            setAuthorizing(false);
            navigate('/profile')
        } catch (err) {
            console.error(err);
            setError(err.response.data.error);
            setAuthorizing(false);
        }
    }

    return (
        <div style={{ paddingTop: 64 }}>
            <h3 style={{ textAlign: 'center' }}>Create Account</h3>
            <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', width: 300, margin: 'auto' }}>
                <input type="text" name="username" value={credentials.username} onChange={handleChange} placeholder='Username' required />
                <input type="text" name="password" value={credentials.password} onChange={handleChange} placeholder='Password' required />
                <button disabled={authorizing}>{authorizing ? 'Authorizing...' : 'Sign Up'}</button>
                {error && <p>{error}</p>}
                <Link to='/login'>Already a member?</Link>
            </form>
        </div>
    )
}