import { useState } from "react"
import { Link, useNavigate } from "react-router-dom"
import { useAuthContext } from "../hooks";

export const Login = () => {
    const { login } = useAuthContext();
    const [credentials, setCredentials] = useState({ username: '', password: '' });
    const [error, setError] = useState(null);
    const [authorizing, setAuthorizing] = useState(false);
    const navigate = useNavigate();

    const handleChange = e => {
        const { name, value } = e.target;
        setCredentials(prev => ({ ...prev, [name]: value }));
    }

    const handleSubmit = async (e) => {
        setError(null);
        setAuthorizing(true);
        e.preventDefault();
        try {
            await login(credentials)
            setAuthorizing(false);
            navigate('/profile')
        } catch (err) {
            console.error(err);
            setError(err.response.data.error);
            setAuthorizing(false);
        }
    }

    return (
        <div style={{paddingTop: 64}}>
            <form onSubmit={handleSubmit} style={{display: 'flex', flexDirection:'column', width: 300, margin:'auto'}}>
                <input type="text" name="username" value={credentials.username} onChange={handleChange} placeholder='Username' required />
                <input type="text" name="password" value={credentials.password} onChange={handleChange} placeholder='Password' required />
                <button disabled={authorizing}>{authorizing ? 'Authorizing...' : 'Login'}</button>
                {error && <p>{error}</p>}
                <Link to='/signup'>Create an account</Link>
            </form>
        </div>
    )
}