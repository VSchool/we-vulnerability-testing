const ex = require('express');
const { getAllUsers, findUserById, deleteUser, updateUser } = require('../services/user');

const userRouter = ex.Router();

userRouter.get('/', async (req, res, next) => {
    try {
        const users = await getAllUsers();
        res.status(200).send({ success: true, users })
    } catch (err) {
        console.error(err);
        res.status(500);
        next(err.message);
    }
})

userRouter.get('/:id/profile', async (req, res, next) => {
    try {
        const { id } = req.params;
        const user = await findUserById(id);
        if (!user) throw Error('That user does not exist')
        res.status(200).send({ success: true, user })
    } catch (err) {
        console.error(err);
        res.status(500);
        next(err.message);
    }
})

userRouter.delete('/:id', async (req, res, next) => {
    try {
        const { id } = req.params;
        await deleteUser(id);
        res.status(200).send({
            success: true,
            id
        })
    } catch (err) {
        console.error(err);
        res.status(500);
        next(err.message);
    }
})

userRouter.put('/:id', async (req, res, next) => {
    try {
        const { id } = req.params;
        const user = await updateUser(id, req.body.user);
        res.status(200).send({
            success: true,
            user
        })
    } catch (err) {
        console.error(err);
        res.status(500);
        next(err.message);
    }
})

module.exports = {
    userRouter
}