const ex = require('express');
const path = require('path');
const { authRouter } = require('./routers/authRouter');
const { userRouter } = require('./routers/userRouter');
const { staticRouter } = require('./routers/staticRouter');
const { errorHandler, log, verifyAccessToken } = require('./middleware');

const server = ex();

server.use(
    ex.json(),
    log,
    ex.static(path.resolve(__dirname, 'client', 'dist'))
);

server.use('/auth', authRouter);
server.use('/api', verifyAccessToken())
server.use('/api/users', userRouter);

server.get('*', staticRouter);

server.use(errorHandler);


module.exports = {
    server
}